#lang racket

(require "../s-exp-stlc.rkt"
         "../stlc-sexp-gen.rkt"
         future-visualizer)

(define expr (gen-well-formed-sexp 20 100))

(define 10-exprs (make-vector 10 expr))
(displayln "10 expressions")
(displayln "sequential")
(time (typecheck-sequential 10-exprs))
(collect-garbage)(collect-garbage)
(displayln "naive parallel")
(time (naive-typecheck-parallel 10-exprs))
(collect-garbage)(collect-garbage)
(displayln "better parallel")
(time (better-typecheck-parallel 10-exprs))
(collect-garbage)(collect-garbage)

(define 50-exprs (make-vector 50 expr))
(displayln "50 expressions")
(displayln "sequential")
(time (typecheck-sequential 50-exprs))
(collect-garbage)(collect-garbage)
(displayln "naive parallel")
(time (naive-typecheck-parallel 50-exprs))
(collect-garbage)(collect-garbage)
(displayln "better parallel")
(time (better-typecheck-parallel 50-exprs))
(collect-garbage)(collect-garbage)

(define 100-exprs (make-vector 100 expr))
(displayln "100 expressions")
(displayln "sequential")
(time (typecheck-sequential 100-exprs))
(collect-garbage)(collect-garbage)
(displayln "naive parallel")
(time (naive-typecheck-parallel 100-exprs))
(collect-garbage)(collect-garbage)
(displayln "better parallel")
(time (better-typecheck-parallel 100-exprs))
(collect-garbage)(collect-garbage)

(define 200-exprs (make-vector 200 expr))
(displayln "200 expressions")
(displayln "sequential")
(time (typecheck-sequential 200-exprs))
(collect-garbage)(collect-garbage)
(displayln "naive parallel")
(time (naive-typecheck-parallel 200-exprs))
(collect-garbage)(collect-garbage)
(displayln "better parallel")
(visualize-futures (time (better-typecheck-parallel 200-exprs)))
